<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>

<c:set var="pageTitle" value="ë¶„ë¦¬ë°°ì¶œ ì •ë³´ ê´€ë¦¬" />
<%@ include file="/WEB-INF/jsp/common/articleHeader.jsp"%>

<script>
  function uploadImage() {
    const file = $("#uploadFileInput")[0].files[0];

    if (!file) {
      alert("ì—…ë¡œë“œí•  íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”");
      return;
    }

    const formData = new FormData();
    formData.append("file", file);

    $.ajax({
      url: "/admin/wasteGuide/uploadImage",
      type: "POST",
      data: formData,
      contentType: false,
      processData: false,
      success: function(data) {
        if (data.success) {
          const url = data.url;
          $("#thumbnailPreview").attr("src", url).removeClass("hidden");
          $("#thumbnailInput").val(url);
          alert("ì´ë¯¸ì§€ ì—…ë¡œë“œ ì„±ê³µ!");
        } else {
          alert("ì—…ë¡œë“œ ì‹¤íŒ¨");
        }
      },
      error: function(err) {
        console.error(err);
        alert("ì˜¤ë¥˜ ë°œìƒ");
      }
    });
  }
</script>

<section class="mt-10 flex">
	<div
		class="container mx-auto max-w-8xl bg-base-100 p-8 rounded-2xl shadow-md">
		<h1 class="text-3xl font-bold mb-6 text-center">â™»ï¸ ë¶„ë¦¬ë°°ì¶œ ì •ë³´ ê´€ë¦¬</h1>

		<div class="bg-base-100 border rounded-xl p-8 mb-4">
			<h2
				class="text-xl font-semibold mb-6 flex justify-center items-center gap-2">
				<span class="text-blue-600 text-lg">ğŸ†•</span> í•™ìŠµ ì •ë³´ ì¶”ê°€
			</h2>

			<div class="flex justify-center">
				<form action="doAddWaste" method="get"
					class="w-full max-w-2xl space-y-4">

					<!-- YOLO ë¼ë²¨ -->
					<div class="grid grid-cols-12 items-center gap-2">
						<label class="col-span-3 text-right font-semibold">YOLO ë¼ë²¨
							(ì˜ë¬¸)</label> <input type="text" name="label"
							class="input input-bordered col-span-9" placeholder="ì˜ˆ: papercup"
							required />
					</div>

					<!-- í•œê¸€ ëª…ì¹­ -->
					<div class="grid grid-cols-12 items-center gap-2">
						<label class="col-span-3 text-right font-semibold">í•œê¸€ ëª…ì¹­</label> <input
							type="text" name="ko_label"
							class="input input-bordered col-span-9" placeholder="ì˜ˆ: ì¢…ì´ì»µ"
							required />
					</div>

					<!-- ì¹´í…Œê³ ë¦¬ -->
					<div class="grid grid-cols-12 items-center gap-2">
						<label
							class="col-span-3 text-right font-semibold whitespace-nowrap">ì¹´í…Œê³ ë¦¬</label>
						<input type="text" name="category"
							class="input input-bordered col-span-9" placeholder="ì˜ˆ: ì¢…ì´"
							required />
					</div>

					<!-- ê°€ì´ë“œ -->
					<div class="grid grid-cols-12 items-start gap-2 flex items-center">
						<label class="col-span-3 text-right font-semibold mt-10">ë¶„ë¦¬ë°°ì¶œ
							ê°€ì´ë“œ</label>
						<textarea name="guide" rows="4"
							class="textarea textarea-bordered col-span-9"
							placeholder="ì˜ˆ: ë‚´ìš©ë¬¼ì„ ë¹„ìš°ê³  ì••ì°©í•œ í›„ ë°°ì¶œí•˜ì„¸ìš”." required></textarea>
					</div>
					<div class="grid grid-cols-12 items-center gap-2">
						<label
							class="col-span-3 text-right font-semibold whitespace-nowrap">íƒ€ì…</label>
						<input type="text" name="wasteType"
							class="input input-bordered col-span-9"
							placeholder="ì˜ˆ: ì¼ë°˜ or ëŒ€í˜• or íŠ¹ìˆ˜" required />
					</div>
					<div class="grid grid-cols-12 items-center gap-2">
						<label
							class="col-span-3 text-right font-semibold whitespace-nowrap">ì¸ë„¤ì¼
							ì´ë¯¸ì§€</label>
						<div class="col-span-9">
							<input type="file" id="uploadFileInput" class="file-input file-input-bordered w-full" accept="image/*" />
							<button type="button" onclick="uploadImage()" class="btn btn-sm btn-outline">ğŸ“¤ ì´ë¯¸ì§€ ì—…ë¡œë“œ</button>
							<img id="thumbnailPreview" src="" class="mt-4 w-40 h-auto hidden border rounded" /> 
							<input type="hidden" name="thumbnail" id="thumbnailInput" required />
						</div>
					</div>
					<div class="relative mt-6 min-h-[48px]">
						<div class="absolute left-1/2 -translate-x-1/2">
							<button type="submit" class="btn btn-primary w-40">ì •ë³´ ì¶”ê°€</button>
						</div>
						<div class="absolute right-18">
							<button type="button" onclick="history.back();" class="btn btn-outline">â† ë’¤ë¡œê°€ê¸°</button>
						</div>
					</div>
				</form>
			</div>
		</div>
		<div class="border rounded-xl p-6">
			<h2 class="text-lg font-semibold mb-4">ğŸ“‹ ë“±ë¡ëœ ì“°ë ˆê¸° ëª©ë¡</h2>
			<table class="table w-full">
				<tbody>
					<c:forEach var="wasteGuide" items="${wasteGuides}">
						<tr>
							<td class="align-top">${wasteGuide.getId()}</td>
							<td class="w-full">
								<form action="doModifyWaste" method="get"
									class="flex items-center gap-2 w-full">
									<input type="hidden" name="wasteId"value="${wasteGuide.getId()}" /> 
									<input type="text" name="label" class="input input-bordered input-sm !w-24 shrink-0" value="${wasteGuide.getLabel()}" required /> 
									<input type="text" name="ko_label" class="input input-bordered input-sm !w-30 shrink-0" value="${wasteGuide.getKo_label()}" required /> 
									<input type="text" name="category" class="input input-bordered input-sm !w-20 shrink-0"value="${wasteGuide.getCategory()}" required />
									<input type="text" name="wasteType" class="input input-bordered input-sm !w-20 shrink-0"value="${wasteGuide.getWasteType()}" required />
									<input type="text" name="guide" class="input input-bordered input-sm flex-grow" value="${wasteGuide.getGuide()}" required />
									<button type="submit" class="btn btn-sm btn-success ml-2 shrink-0">ìˆ˜ì •</button>
								</form>
							</td>
							<td class="align-middle">
								<form action="doDeleteWaste" method="get"
									class="flex items-center justify-center"
									onsubmit="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
									<input type="hidden" name="wasteId"
										value="${wasteGuide.getId()}" />
									<button type="submit" class="btn btn-sm btn-error">ì‚­ì œ</button>
								</form>
							</td>
						</tr>
					</c:forEach>
				</tbody>
			</table>
		</div>
	</div>
</section>

<%@ include file="/WEB-INF/jsp/common/footer.jsp"%>